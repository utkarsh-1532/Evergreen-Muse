{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the user in the authentication system. (Relationship: User 1:1 UserProfile)"
        },
        "username": {
          "type": "string",
          "description": "The user's unique username.",
          "format": "string"
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "profilePicUrl": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        },
        "bio": {
          "type": "string",
          "description": "A short biography or description of the user."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the profile was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "username",
        "email",
        "createdAt"
      ]
    },
    "Post": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Post",
      "type": "object",
      "description": "Represents a user's post in the social feed.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the post."
        },
        "authorId": {
          "type": "string",
          "description": "Reference to the user who created the post. (Relationship: User 1:N Post)"
        },
        "title": {
          "type": "string",
          "description": "Title of the post."
        },
        "text": {
          "type": "string",
          "description": "Main text content of the post."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the image attached to the post.",
          "format": "uri"
        },
        "imageCaption": {
          "type": "string",
          "description": "Caption for the image."
        },
        "songTitle": {
          "type": "string",
          "description": "Title of the song associated with the post."
        },
        "songArtist": {
          "type": "string",
          "description": "Artist of the song associated with the post."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp indicating when the post was created.",
          "format": "date-time"
        },
        "likeIds": {
          "type": "array",
          "description": "References to users who liked the post. (Relationship: User N:N Post via Like)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "authorId",
        "text",
        "timestamp"
      ]
    },
    "Like": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Like",
      "type": "object",
      "description": "Represents a like on a post by a user. This is an intermediary entity for the N:N relationship between User and Post.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the like."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the user who liked the post. (Relationship: User 1:N Like)"
        },
        "postId": {
          "type": "string",
          "description": "Reference to the post that was liked. (Relationship: Post 1:N Like)"
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp indicating when the post was liked.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "postId",
        "timestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/userProfiles/{userProfileId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. The 'userId' field links this profile to the Firebase Auth user. Enforces uniqueness of usernames.",
          "params": [
            {
              "name": "userProfileId",
              "description": "Unique identifier for the user profile document."
            }
          ]
        }
      },
      {
        "path": "/global_posts/{postId}",
        "definition": {
          "entityName": "Post",
          "schema": {
            "$ref": "#/backend/entities/Post"
          },
          "description": "Stores all user-generated posts in a single, top-level collection for the global social feed.",
          "params": [
            {
              "name": "postId",
              "description": "The unique identifier for the post."
            }
          ]
        }
      },
      {
        "path": "/global_posts/{postId}/likes/{likeId}",
        "definition": {
          "entityName": "Like",
          "schema": {
            "$ref": "#/backend/entities/Like"
          },
          "description": "Stores likes for each post. Includes 'userId' to track who liked the post.",
          "params": [
            {
              "name": "postId",
              "description": "The unique identifier for the post."
            },
            {
              "name": "likeId",
              "description": "The unique identifier for the like."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure has been simplified to use a top-level `global_posts` collection for the social feed. This avoids the need for complex and potentially error-prone collection group queries, resolving persistent permission issues.\n\n*   **User Profiles:** Stored in a dedicated `userProfiles` collection to ensure username uniqueness and separation of concerns.\n*   **Global Posts:** All posts from all users are stored in a single `global_posts` collection. This makes querying for the main social feed simple and efficient, requiring only a basic collection query. The `authorId` field within each post document maintains clear ownership.\n*   **Likes:** Likes are now stored as subcollections under each post in the `global_posts` collection (`/global_posts/{postId}/likes/{likeId}`). This structure allows for efficient querying of likes for a specific post.\n\nThis simplified, denormalized structure prioritizes efficient read operations for the main feed, which is the most common use case, and resolves previous security rule complexities."
  }
}
