{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the user in the authentication system. (Relationship: User 1:1 UserProfile)"
        },
        "username": {
          "type": "string",
          "description": "The user's unique username.",
          "format": "string"
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "profilePicUrl": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        },
        "bio": {
          "type": "string",
          "description": "A short biography or description of the user."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the profile was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "username",
        "email",
        "createdAt"
      ]
    },
    "Post": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Post",
      "type": "object",
      "description": "Represents a user's post in the social feed.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the post."
        },
        "authorId": {
          "type": "string",
          "description": "Reference to the user who created the post. (Relationship: User 1:N Post)"
        },
        "authorUsername": {
          "type": "string",
          "description": "The username of the post's author (denormalized)."
        },
        "authorProfilePicUrl": {
          "type": "string",
          "description": "URL of the author's profile picture (denormalized).",
          "format": "uri"
        },
        "title": {
          "type": "string",
          "description": "Title of the post."
        },
        "text": {
          "type": "string",
          "description": "Main text content of the post."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the image attached to the post.",
          "format": "uri"
        },
        "imageCaption": {
          "type": "string",
          "description": "Caption for the image."
        },
        "songTitle": {
          "type": "string",
          "description": "Title of the song associated with the post."
        },
        "artistName": {
          "type": "string",
          "description": "Artist of the song associated with the post."
        },
        "albumArtUrl": {
          "type": "string",
          "description": "URL of the album art for the associated song.",
          "format": "uri"
        },
        "audioPreviewUrl": {
          "type": "string",
          "description": "URL for a preview snippet of the associated song.",
          "format": "uri"
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp indicating when the post was created.",
          "format": "date-time"
        },
        "likeIds": {
          "type": "array",
          "description": "References to users who liked the post. (Relationship: User N:N Post via Like)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "authorId",
        "authorUsername",
        "text",
        "timestamp"
      ]
    },
    "Like": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Like",
      "type": "object",
      "description": "Represents a like on a post by a user. This is an intermediary entity for the N:N relationship between User and Post.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the like."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the user who liked the post. (Relationship: User 1:N Like)"
        },
        "postId": {
          "type": "string",
          "description": "Reference to the post that was liked. (Relationship: Post 1:N Like)"
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp indicating when the post was liked.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "postId",
        "timestamp"
      ]
    },
    "Habit": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Habit",
      "type": "object",
      "description": "Represents a user's trackable daily habit.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the habit."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the user who owns the habit."
        },
        "title": {
          "type": "string",
          "description": "The description of the habit (e.g., 'Read 10 pages')."
        },
        "streak": {
          "type": "number",
          "description": "The current consecutive day streak for the habit."
        },
        "lastCompleted": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp of the last time the habit was marked as completed."
        },
        "completedDates": {
          "type": "array",
          "description": "A list of timestamps for each day the habit was completed.",
          "items": {
            "type": "string",
            "format": "date-time"
          }
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the habit was created.",
          "format": "date-time"
        }
      },
      "required": [
        "userId",
        "title",
        "createdAt"
      ]
    },
    "LearningSeed": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LearningSeed",
      "type": "object",
      "description": "Represents a single piece of knowledge in the spaced repetition system.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "Reference to the user who owns this seed."
        },
        "front": {
          "type": "string",
          "description": "The front of the card (e.g., a question or concept)."
        },
        "back": {
          "type": "string",
          "description": "The back of the card (e.g., an answer or definition)."
        },
        "box": {
          "type": "number",
          "description": "The current Spaced Repetition System (SRS) level, from 0 to 5."
        },
        "nextReview": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp for when this seed is next due for review."
        },
        "category": {
          "type": "string",
          "description": "A user-defined category for organizing seeds."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp indicating when the seed was created."
        }
      },
      "required": [
        "userId",
        "front",
        "back",
        "box",
        "nextReview",
        "createdAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/userProfiles/{userProfileId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. The 'userId' field links this profile to the Firebase Auth user. Enforces uniqueness of usernames.",
          "params": [
            {
              "name": "userProfileId",
              "description": "Unique identifier for the user profile document."
            }
          ]
        }
      },
      {
        "path": "/userProfiles/{userProfileId}/habits/{habitId}",
        "definition": {
          "entityName": "Habit",
          "schema": {
            "$ref": "#/backend/entities/Habit"
          },
          "description": "Stores individual habits for a user.",
          "params": [
            {
              "name": "userProfileId",
              "description": "The unique identifier for the user profile."
            },
            {
              "name": "habitId",
              "description": "The unique identifier for the habit."
            }
          ]
        }
      },
      {
        "path": "/global_posts/{postId}",
        "definition": {
          "entityName": "Post",
          "schema": {
            "$ref": "#/backend/entities/Post"
          },
          "description": "Stores all user-generated posts in a single, top-level collection for the global social feed.",
          "params": [
            {
              "name": "postId",
              "description": "The unique identifier for the post."
            }
          ]
        }
      },
      {
        "path": "/global_posts/{postId}/likes/{likeId}",
        "definition": {
          "entityName": "Like",
          "schema": {
            "$ref": "#/backend/entities/Like"
          },
          "description": "Stores likes for each post. Includes 'userId' to track who liked the post.",
          "params": [
            {
              "name": "postId",
              "description": "The unique identifier for the post."
            },
            {
              "name": "likeId",
              "description": "The unique identifier for the like."
            }
          ]
        }
      },
      {
        "path": "/userProfiles/{userProfileId}/seeds/{seedId}",
        "definition": {
          "entityName": "LearningSeed",
          "schema": {
            "$ref": "#/backend/entities/LearningSeed"
          },
          "description": "Stores individual knowledge seeds for a user's spaced repetition learning system.",
          "params": [
            {
              "name": "userProfileId",
              "description": "The unique identifier for the user profile."
            },
            {
              "name": "seedId",
              "description": "The unique identifier for the learning seed."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure has been simplified to use a top-level `global_posts` collection for the social feed. This avoids the need for complex and potentially error-prone collection group queries. User-specific data like Habits and Learning Seeds are stored in subcollections under their `userProfiles` document to ensure data is logically grouped and secured by a simple ownership rule."
  }
}
